/*! acrum 0.3.0 */

(function(){var e,n,t,o,r,i=[].slice,u=function(e,n){return(+e%(n=+n)+n)%n};t=function(){return"undefined"!=typeof module&&null!==module&&!("undefined"!=typeof window&&null!==window?window.module:void 0)},r=function(){var e,n,o;return t()?(require("xmlhttprequest").XMLHttpRequest,1e3*((o=process.hrtime())[0]+o[1]/1e9)):null!=(e=null!=(n=window.performance)&&"function"==typeof n.now?n.now():void 0)?e:+new Date},new Date,n=function(){var e,n,t,o,r,u,a;for(e=arguments[0],n=0,o=(u=2<=arguments.length?i.call(arguments,1):[]).length;n<o;n++){r=u[n];for(t in r)a=r[t],e[t]=a}return e},(o=function(){var e,n;if(e=1<=arguments.length?i.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console&&null!=(n=console.log)?n.call:void 0))return console.log.apply(console,e)}).error=function(){var e,n;if(e=1<=arguments.length?i.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console&&null!=(n=console.error)?n.call:void 0))return console.error.apply(console,e)},e=function(){var e,i,a,l,d,c,f,s,w,m,p,g,v,y,h,L,S,q,K,O,x,P,b,M,A,H,R,T,X,C,D,E,I,k;if(m={host:"https://rum.serv-ac.com",maxInterval:5e3,aggregationInterval:400,decimalPrecision:3,sendLatency:!1,sample:1,active:!0},E={},!t()&&(e="function"==typeof document.querySelector?document.querySelector("[acrum-ds], [acrum-perf], [acrum-state]"):void 0))for(E={host:e.getAttribute("acrum-ds")&&""!==e.getAttribute("acrum-ds")?e.getAttribute("acrum-ds"):m.host,pageStateKey:!e.getAttribute("acrum-state")||e.getAttribute("acrum-state"),pagePerformanceKey:e.getAttribute("acrum-perf")},h=0,K=(A=["pagePerformanceKey","pageStateKey"]).length;h<K;h++)"true"===(null!=(H=E[S=A[h]])?H.toString().toLowerCase():void 0)||""===E[S]?E[S]=!0:"false"===(null!=(R=E[S])?R.toString().toLowerCase():void 0)&&(E[S]=null);return b=n({},m,E),i=b.active,(I=function(){return i=b.active&&Math.random()<b.sample})(),d=window.performance.timing.navigationStart,l=[],a={},D=function(e){return n(b,e),("sample"in e||"active"in e)&&I(),b},M={},L=!1,f=function(){return M={}},p=function(e,n){if(i)return M[e]=n,w()},X=null,P=null,g=function(){return clearTimeout(X),clearTimeout(P),P=setTimeout(g,b.maxInterval),X=null,T()},y={},C=function(e){return y=e},c=function(){return y={}},w=function(){if(clearTimeout(X),X=setTimeout(g,b.aggregationInterval),null==P)return P=setTimeout(g,b.maxInterval)},x=function(e,n){var o,i,u,a,l,d,c,f,s,w;i=t()||window.XMLHttpRequest&&(window.XMLHttpRequest.defake||"withCredentials"in new window.XMLHttpRequest),f=!!t()||(!(a=/^(https?:\/\/[^\/]+)/i.exec(b.host))||a[1]===document.location.protocol+"//"+document.location.host),s=r(),o={};for(l in e)w=e[l],o[l]=w;(c=f||i||null==("undefined"!=typeof window&&null!==window?window.XDomainRequest:void 0)?new(null!=(d="undefined"!=typeof window&&null!==window?window.XMLHttpRequest:void 0)?d:XMLHttpRequest):new window.XDomainRequest).acrum={track:!1},c.open("POST",b.host+"/v1/send",!0),c.setRequestHeader("Content-Type","application/json");for(l in n)u=n[l],c.addEventListener(l,u,!1);for(l in y)u=y[l],c.addEventListener(l,u,!1);return c.addEventListener("load",function(){return k(r()-s)},!1),c.send(JSON.stringify(o)),c},L=!1,T=function(){var e,n,t,r,u,a;if(i){if(L)o("Sending in progress, aborting");else if(0!==Object.keys(M).length){(r={}).protocol=location.protocol.toString().replace(":",""),r.hostname=location.hostname,r.path=location.pathname,r.args=location.search,r.userAgent=navigator.userAgent.toString(),null!=window.screen&&((u={}).width=window.screen.width,u.height=window.screen.height,e=v(window.screen.width,window.screen.height),u.aspect_ratio=window.screen.width/e+":"+window.screen.height/e,r.screen=u),"undefined"!=typeof acrum_extra&&null!==acrum_extra&&(r.extra=acrum_extra);for(S in M)a=M[S],l.push({key:S,value:a}),r[S]=a;return t=function(e){return L=!1,M={}},n=function(e){return L=!1},L=!0,x(r,{load:t,error:n})}}else o("Would send acrum queue")},v=function(e,n){return 0===n?e:v(n,u(e,n))},q=!1,k=function(e){if(b.sendLatency&&!q)return p("acrum.latency",e),q=!0,setTimeout(function(){return q=!1},3e5)},O=function(e){var n,t,u,s,w,m,v;null==e&&(e=""),m=!1,w=!1,s=!1,u=function(n){return null==n&&(n=""),(S=null!=e?e:"")&&n&&(S+="."),n&&(S+=n),O(S)},n={send:function(e,n){if(null!=n&&null!=e)return p(e,n);o.error("Can't log "+e+":"+n)},now:r,sendOnStart:function(e){var n;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!m&&(e&&!0!==e||(e="events"),a.start=0,p(e,a),m=!0))},sendOnDOMLoad:function(e){var n,o;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!w&&(e&&!0!==e||(e="events"),"uninitialized"===(o=document.readyState)||"loading"===o?("function"==typeof window.addEventListener&&window.addEventListener("DOMContentLoaded",function(n){return function(){if(a.domload=(window.performance.timing.domLoading-d)/1e3,p.call(n,e,a),b.pagePerformanceKey)return t.call(n,b.pagePerformanceKey)}}(this),!1),w=!0):void 0))},sendOnLoad:function(e){var n,o;return null!=("undefined"!=typeof window&&null!==window&&null!=(n=window.performance)?n.timing:void 0)&&(!s&&(e&&!0!==e||(e="events"),"uninitialized"===(o=document.readyState)||"loading"===o?("function"==typeof window.addEventListener&&window.addEventListener("load",function(n){return function(){if(a.finished=(window.performance.timing.domComplete-d)/1e3,p.call(n,e,a),b.pagePerformanceKey)return t.call(n,b.pagePerformanceKey)}}(this),!1),s=!0):void 0))},getPagePerformance:t=function(e){var n,t,o,r,i;if(null==("undefined"!=typeof window&&null!==window&&null!=(o=window.performance)?o.timing:void 0))return!1;e&&!0!==e||(e="performance"),t={},r=window.performance.timing;for(n in r)"number"==typeof(i=r[n])&&0!==i&&(t[n]=(i-d)/1e3);return p(e,t),!0},flush:g,clearQueue:f,setHandlers:C,isSending:L,clearHandlers:c,setOptions:D,options:b,history:l,active:i};for(S in n)v=n[S],u[S]=v;return u},s=O(),b.pageStateKey&&(s.sendOnStart(b.pageStateKey),s.sendOnDOMLoad(b.pageStateKey)),(b.pageStateKey||b.pagePerformanceKey)&&s.sendOnLoad(b.pageStateKey),s},"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.Acrum=e()}).call(this);
